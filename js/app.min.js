const tabs = document.querySelectorAll('.tabs');

const setTab = (parentId, index) => {
  const parent = document.getElementById(parentId);
  const tabs = parent.querySelectorAll('.tab-button');
  const tabContents = parent.querySelectorAll('.tab-content__item');
  tabContents.forEach(tabContent => {
    const tabIndex = tabContent.dataset.tab;
    if (tabIndex === index) {
      tabContent.classList.add('active');
    } else {
      tabContent.classList.remove('active');
    }
  });
  if (tabs.length > 0) {
    tabs.forEach(tab => {
      const tabIndex = tab.dataset.tab;
      if (tabIndex === index) {
        tab.classList.add('active');
      } else {
        tab.classList.remove('active');
      }
    });
  }
}

function IntTabs(id) {
  const tabs = document.getElementById(id);
  if (tabs) {
    const tabButtons = tabs.querySelectorAll('.tab-button');
    tabButtons.forEach(tabButton => {
      tabButton.addEventListener('click', () => {
        setTab(tabs.id, tabButton.dataset.tab);
      });
    });
  }
}

IntTabs('auth-modal-tab');

$('.forgot-pass-btn').on('click', () => {
  setTab('auth-modal-tab', '4');
  $('#auth-modal-tab .tab-buttons').hide();
  $('#auth-modal-main-title').hide();
});

$('.end-change-pass-btn, .auth-modal .close-btn').on('click', () => {
  $('#auth-modal-main-title').show();
  $('#auth-modal-tab .tab-buttons').show();
  setTab('auth-modal-tab', '1');
  closeModal('auth-modal');
});


const closeModal = (modalId) => {
    $(`#${modalId}`).removeClass('visible');
    $('body').removeClass('_lock');
}

$('.modal .close-btn').click(function() {
    const modalId = $(this).closest('.modal').attr('id');
    closeModal(modalId);
});

const openModal = (modalId) => {
    $(`#${modalId}`).addClass('visible');
    $('body').addClass('_lock');
}
const mainSwiper = new Swiper('.main__swiper .swiper', {
	slidesPerView: 'auto',
	centeredSlides: true,
	loop: true,
	navigation: {
		nextEl: '.main__swiper .slide-next',
		prevEl: '.main__swiper .slide-prev',
	},
	autoplay: {
		delay: 2500,
		disableOnInteraction: false,
	},
	effect: "coverflow",
	coverflowEffect: {
		rotate: 0,       // отключаем поворот
		stretch: 0,      // расстояние между слайдами
		depth: 200,      // глубина (чем больше — тем дальше уходят боковые)
		modifier: 1.5,   // множитель эффекта
		scale: .9899,      // активный слайд больше (1 = обычный, 1.2 = на 20% крупнее)
		slideShadows: true,
	},
});

setTimeout(() => {
	// mainSwiper.slideNext();
	$('.main__swiper .slide-next').trigger('click');
	$('.loader').remove();
}, 1000);

const mainCategoriesSwiper = new Swiper('.main__categories .swiper', {
	slidesPerView: 'auto',
	loop: true,
	navigation: {
		nextEl: '.main__categories .slide-next',
		prevEl: '.main__categories .slide-prev',
	},
});


const topWeekSwiper = new Swiper('.top-week .swiper', {
	slidesPerView: 'auto',
	loop: true,
	navigation: {
		nextEl: '.top-week .slide-next',
		prevEl: '.top-week .slide-prev',
	},
});

const moviesSwiper = new Swiper('.movies-swiper .swiper', {
	slidesPerView: 'auto',
	loop: false,
});

$('.burger-btn').on('click', function (e) {
	$('.header-mobile').slideToggle(500);
	$('body').toggleClass('_lock');
	$(this).toggleClass('active');
	e.stopPropagation();
	$('body').click(function () {
		$('.header-mobile').slideUp(500);
		$('body').removeClass('_lock');
		$('.burger-btn').removeClass('active');
	});
});

$('.mobile-login-btn').on('click', function () {
	openModal('auth-modal');
	$('.header-mobile').slideUp(500);
	$('body').removeClass('_lock');
	$('.burger-btn').removeClass('active');
});


$('.movie-genere-btn').on('click', function () {
	$(this).toggleClass('active');
});


$('.wishlist-btn').on('click', function () {
	$(this).toggleClass('active');
});


$('.set-rating-btn').on('click', function () {
	$('.set-rating-btn').removeClass('active');
	$(this).toggleClass('active');
});

$(".description-btn").on('click', function () {
	$('.movies-detail__parameters').hide();
	$('.movies-detail__description').show();
	$(this).addClass('active');
	$(".details-btn").removeClass('active');
});

$(".details-btn").on('click', function () {
	$('.movies-detail__parameters').show();
	$('.movies-detail__description').hide();
	$(this).addClass('active');
	$(".description-btn").removeClass('active');
});
const isTv = $('.tv-wrapper').length > 0;


if (isTv) {
	$('.tv-header .menu').on('mouseenter', function () {
		setTimeout(() => {
			$('.tv-header').addClass('active');
		}, 500);
	});

	$('.tv-header .menu').on('mouseleave', function () {
		setTimeout(() => {
			$('.tv-header').removeClass('active');
		}, 500);
	});
	$('.move-item').on('mouseenter', function () {
		$(this).addClass('active');
	});
	$('.move-item').on('mouseleave', function () {
		$(this).removeClass('active');
	});
}

$('.end-payment-btn').on('click', function () {
	closeModal('payment-modal');
	closeModal('subscribe-modal');
	setTab('payment-modal-tab', '1');
	openModal('success-payment-modal');
});

$('.auth-modal__type-item').on('click', function () {
	$('.auth-modal__type').hide();
	$('.tv-auth-modal__description').hide()
	if ($(this).val() == '1') {
		$('.tv-auth-modal__title').text('Почта')
		$('.auth-modal__registration').show();
		$('.auth-modal__login').hide();
	} else {
		$('.tv-auth-modal__title').text('Почта')
		$('.auth-modal__registration').hide();
		$('.auth-modal__login').show();
	}
});

$('.reg-step-btn').on('click', function () {
	const val = $('.email-input input').val();
	const pass = $('.reg-pass-input input.pass').val();
	const passConfirm = $('.reg-pass-input input.pass-confirm').val();
	const codeInputs = $('.registration-code input');

	if (val.length > 0) {
		$('.auth-modal__registration .email-input').hide();
		$('.auth-modal__registration .reg-pass-input').show();
	} else {
		$('.auth-modal__registration .email-input').show();
		$('.auth-modal__registration .reg-pass-input').hide();
	}

	if (pass !== '' && pass === passConfirm) {
		$('.auth-modal__registration .reg-pass-input').hide();
		$('.registration-code').show();
		$('.tv-auth-modal__description').text('Мы отправили код подтверждения на postexample@gmail.com').show()
	}

	let hasValue = false;
	codeInputs.each(function () {
		if ($(this).val().trim() !== '') {
			hasValue = true;
			return false;
		}
	});

	if (hasValue) {
		$('.auth-modal__type').show();
		$('.tv-auth-modal__description').show();
		closeModal('auth-modal');
	}
});

$('.login-step-btn').on('click', function () {
	const email = $('.login-email-input input').val();
	const pass = $('.login-pass-input input.pass').val();

	if (email.length) {
		$('.login-email-input').hide();
		$('.login-pass-input').show();
		$('.tv-auth-modal__title').text('Пароль')
	}

	if (pass.length) {
		closeModal('auth-modal');
	}
});